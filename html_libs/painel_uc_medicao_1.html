<script type="text/javascript">
    

    /*
     * DESENHAR GRÁFICOS
     * 
     */
    function drawChart() {
    
        var data = new google.visualization.DataTable();
        data.addColumn('date', 'Datas'); // Implicit domain label col.
        data.addColumn('number', 'Medido'); // Implicit series 1 data col.
        data.addColumn({type:'string', role:'annotation'}); // annotation role col.
        //data.addColumn({type:'string', role:'annotationText'}); // annotationText col.
        data.addColumn({type:'string', role:'tooltip', 'p': {'html': true}}); // annotationText col.
        data.addRows([{CHARTDATA}]);
        var options = {
            title: 'Medições do Hidrômetro',
            legend: { position: "none" },
            hAxis: {title: 'Dias do período', titleTextStyle: {color: '#47A3DA'}, baselineColor: 'blue', format:'d MMM y', minValue: new Date({DATA_INIC})},
            vAxis: {titleTextStyle: {color: '#47A3DA'}}, pointSize: 5,
            curveType: 'function',
            tooltip: {isHtml: true},
            //colors: ['MediumSeaGreen','#D9EDF7','#DB261D','DarkGreen','#DB261D','Lime','Chartreuse','GreenYellow','YellowGreen','OliveDrab','DarkOliveGreen','Olive','','','',''] //ORIGINAL
            colors: ['#DB261D','Lime','Chartreuse','GreenYellow','YellowGreen','OliveDrab','DarkOliveGreen','Olive','','','',''] 
        };

        var chart = new google.visualization.LineChart(document.getElementById('chart_med'));
        chart.draw(data, options);
    }
    /*
     * Gráfico de META
     * 
     */
     function drawChart2() {
        
         var data = google.visualization.arrayToDataTable([
                             ['x', '{TIPOMEDIDA}', { role: 'style' }, { role: 'annotation' }],
                             ['{REFERENCIA}', {CON_PERIODO}, '#47A3DA', '{REFERENCIA}\n {CON_PERIODO} {TIPOMEDIDA}'], // RGB value
                             ['META', {META}, '#DB261D', 'META {META} {TIPOMEDIDA}'], // English color name
                     ]);
        var options = {
            hAxis: { titleTextStyle: {color: '#47A3DA'}, baselineColor: 'blue', format:'d MMM y', minValue: new Date({DATA_INIC})},
            vAxis: {titleTextStyle: {color: '#47A3DA'}}, pointSize: 5,
            //tooltip: {isHtml: true},
            legend: { position: "none" }
            //colors: ['MediumSeaGreen','#D9EDF7','#DB261D','DarkGreen','#DB261D','Lime','Chartreuse','GreenYellow','YellowGreen','OliveDrab','DarkOliveGreen','Olive','','','',''] //ORIGINAL
            //colors: ['GreenYellow','#DB261D','Chartreuse','GreenYellow','YellowGreen','OliveDrab','DarkOliveGreen','Olive','','','',''] 
        };

        var chart = new google.visualization.ColumnChart(document.getElementById('chart_meta'));
        chart.draw(data, options);
    }           
    
    
    $(document).ready(function(){
        
        $('.muda-periodo').click(function(e){
        
            //alert("sad");
            e.preventDefault();
            var href = $(this).attr('href');
            $('#conteudo').load(href, function(){
                drawChart();
                drawChart2();
       
            });
        
        });
        
        $('[data-toggle="tooltip"]').tooltip(); 
        
        /*
         * Calcular médias ao alterar campos
         * 
         */
        $('.dias-ut').change(function(){
            
            var dias = $(this).val();
            var index= $(this).attr('title');
            var cons = parseInt($('input[name=' + index + ']').val());
            var fixa = parseInt($('#fixa').val());
            var flut = parseInt($('.pop-flu[title=' + index + ']').val());
            var med_dia = (dias > 0 ) ? cons/dias : cons;
            var med_pes = med_dia/(fixa + flut);
            $('#TR-D'+ index).html(Math.round(med_dia * 100) / 100);
            $('#TR-P'+ index).html(Math.round(med_pes * 100) / 100);
            
        });
        
        $('.pop-flu').change(function(){
            
            var index= $(this).attr('title');
            var dias = parseInt($('.dias-ut[title=' + index + ']').val());
            var cons = parseInt($('input[name=' + index + ']').val());
            var fixa = parseInt($('#fixa').val());
            var flut = parseInt($(this).val());
            var med_dia = (dias > 0 ) ? cons/dias : cons;
            var med_pes = med_dia/(fixa + flut);
            $('#TR-D'+ index).html(Math.round(med_dia * 100) / 100);
            $('#TR-P'+ index).html(Math.round(med_pes * 100) / 100);
            
        });
        
    });

</script>

    <!-- BEGIN NORESULTS -->
    <div class="alert alert-danger">
        Não foram encontradas medições para o este período. <strong><a href="src/painel_uc/medicao.php" class="muda-periodo">Clique aqui para voltar</a></strong>
    </div>
    <!-- END NORESULTS -->
    <!-- BEGIN RESULTS -->
<div class="row" id="grafico">
    <div class="col-md-8">
        <h2>RGI {UCNOME}</h2>    
    </div>
    <div class="col-md-4" align="right">
        <h2>Data: {DATA_HOJE}</h2>
    </div>
</div>

<div class="container rounded" style="padding:15px; margin-top: 27px">
    <div class="col-md-12">
        <div class="row">
            <div class="col-md-4" style="padding-top:6px">
                <h4>RGI: <kbd>{UCNOME}</kbd></h4>
            </div>
            <div class="col-md-4 text-center">
                <h1>{REFERENCIAC} </h1><small>(Total de <b>{PERIODO}</b> dias) <i>mês de referência da nota pela empresa</i></small>
            </div>
            <div class="col-md-4" align="right">
                <h4>
                    <a href="src/painel_uc/medicao.php?mes={MES_ANT}&ano={ANO_ANT}" class="btn btn-warning muda-periodo">&Lt;</a> 
                    <span style="text-decoration: underline">{DATA_INI} a {DATA_FIN}</span> 
                    <a href="src/painel_uc/medicao.php?mes={MES_POS}&ano={ANO_POS}" class="btn btn-warning muda-periodo">&Gt;</a>
                </h4>
            </div>
        </div>
        <div class="row">
            <div id="chart_med" style="margin-top:15px"></div>
        </div>
    </div>
    <div class="col-md-12">
        <div class="row" style="margin-top:10px;" >
            <div class="col-md-3 col-md-offset-1">
                <a href="src/painel_uc/medicao.php?mes={MES_ANT}&ano={ANO_ANT}" class="btn btn-warning muda-periodo">
                    <b>&Lt; MÊS ANTERIOR</b> <span class="badge">{MES_ANTERIOR}/{ANO_ANT}</span>                
                </a>
            </div>
            <div class="col-md-4" id="chart_meta" style="height: 200px"></div>
            <div class="col-md-3" align="right">
                <a href="src/painel_uc/medicao.php?mes={MES_POS}&ano={ANO_POS}" class="btn btn-warning muda-periodo" id="posterior"> 
                    <b>MÊS POSTERIOR <span class="badge">{MES_POSTERIOR}/{ANO_POS}</span> &Gt;</b>
                </a>
            </div>
        </div>
        <div class="row col-md-10 col-md-offset-1" style="margin-top:25px; margin-bottom:20px">
            <div class="btn-group btn-group-justified" style="">
                <span class="btn btn-lg bg-danger" > Consumo <code>{MES_ANTERIOR}/{ANO_ANT}</code> : <small> {CON_ANTERIOR} {TIPOMEDIDA}</small></span>
                <span class="btn btn-lg bg-success">Consumo <code>{REFERENCIA}</code> : <small>{CON_PERIODO} {TIPOMEDIDA}</small></span>
                <span class="btn btn-lg bg-info" title="Variação em todo o período">Variação: <small>{VAR_PERIODO} %</small></span>
            </div>
        </div>
        <div class="row col-md-10 col-md-offset-1">
            <blockquote>
            <small><i>* As leituras são <b>SEMPRE CUMULATIVAS</b>. Caso exista uma redução no gráfico, provavelmente houve erro na leitura da conta e será necessária uma investigação.</i></small>
            </blockquote>
        </div>
        
    </div>
    <div class="col-md-12">
        <div class="well">
            <h4><span class=""></span>Informações da Nota : <b>{REFERENCIA}</b></h4>
            {TESTE}
            <!-- BEGIN NOTA_BLOCK -->
            <blockquote>
                <div class="row">

                <ul class="list-group">

                    <li class="list-group-item"><samp><strong>Data de Lançamento:</strong> {NDATA_LANCTO}</samp></li>
                    <li class="list-group-item list-group-item-success"><samp><strong>Data da Leitura:</strong> {NDATA_LEITURA}</samp></li>
                    <li class="list-group-item list-group-item-danger"><samp><strong>Leitura: {NLEITURA} {TIPOMEDIDA}</strong></samp></li>
                    <li class="list-group-item list-group-item-info"><samp><strong>Consumo Faturado: {NCONSUMO} {TIPOMEDIDA}</strong></samp></li>
                    <li class="list-group-item list-group-item-info"><samp><strong>Valor Faturado:</strong> R$ {NVALOR}</samp></li>

                </ul>
                </div>
            </blockquote>
            <!-- END NOTA_BLOCK -->
            <!-- BEGIN SNOTA_BLOCK -->
            <div class="alert alert-warning">A nota ainda não foi lançada no sistema</div>
            <!-- END SNOTA_BLOCK -->
        </div>

    </div>
</div> 
    
<!-- END RESULTS -->